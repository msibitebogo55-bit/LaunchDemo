<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BStream Live</title>
<style>
  body { background: #000; color: #fff; font-family: Arial, sans-serif; margin:0; padding:0; }
  header { padding: 15px; font-size: 24px; background: #111; }
  #video-container { text-align:center; margin: 20px; }
  video { width: 80%; max-width:900px; outline:none; }
  #video-title { margin-top:10px; font-size:22px; font-weight:bold; }
  #ticker { background:#111; padding:10px; text-align:center; font-weight:bold; }
</style>
</head>
<body>
<header>BStream Live</header>
<div id="video-container">
  <video id="live-video" autoplay muted></video>
  <div id="video-title">Loading...</div>
</div>
<div id="ticker">Welcome to BStream!</div>

<script>
const videoEl = document.getElementById("live-video");
const titleEl = document.getElementById("video-title");
let currentVideo = null;

// Disable seeking
videoEl.controls = false;
videoEl.addEventListener("seeking", () => {
  if(currentVideo) videoEl.currentTime = getElapsedTime();
});

// Calculate elapsed time
function getElapsedTime() {
  const now = new Date();
  const start = new Date(currentVideo.startTime);
  return (now - start) / 1000;
}

// Load currently live video
async function loadLive() {
  try {
    const res = await fetch("/now");
    const video = await res.json();
    if(video) {
      currentVideo = video;
      if(videoEl.src !== video.signedUrl) {
        videoEl.src = video.signedUrl;
        videoEl.currentTime = getElapsedTime();
        videoEl.play();
        titleEl.innerText = video.title;
      } else {
        videoEl.currentTime = getElapsedTime();
      }
    } else {
      currentVideo = null;
      videoEl.src = "";
      titleEl.innerText = "No live video currently";
    }
  } catch(err) {
    console.error(err);
  }
}

// Refresh every 5 seconds
setInterval(loadLive, 5000);
loadLive();
</script>
</body>
</html>
